{"version":3,"file":"conduit.db.js","sources":["conduit/db.cljs"],"mappings":";;;;AAWA,wBAAA,2CAAA,kEAAA,rIAAKA;AAOL,8BAAA,9BAAKC;AAEL;;;yBAAA,zBAAMC,0DAEHC;AAFH,AAGE,OAAUC,qBAAgBH,4BAAiB,6CAAKE;;AAIlD;;;4BAAA,5BAAME;AAAN,AAGE,OAAaD,wBAAgBH;;AAa/B,IAAAK,iBAAA;IAAAC,iBAEC;kBAAKE,KAAKC;AAAV,AACE,0DAAA,nDAACC,8CAAMF,kFACA,AAACG,6CAAK,AAACC,uBACD,iBAAAC,WAAS,AAAUV,qBAAgBH;AAAnC,AAAA,GAAA,CAAAa,YAAA;AAAA;;AACS,6DAAAA,tDAACC;;;;;AAN1B,AAAA,6GAAAT,eAAAC,mDAAAD,eAAAC,7LAACC,uDAAAA,sFAAAA","names":["conduit.db/default-db","conduit.db/conduit-user-key","conduit.db/set-user-ls","user","js/localStorage","conduit.db/remove-user-ls","G__27783","G__27784","re-frame.core/reg-cofx","cofx","_","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","cljs.core.into.cljs$core$IFn$_invoke$arity$2","cljs.core/sorted-map","G__27788","cljs.reader.read_string.cljs$core$IFn$_invoke$arity$1"],"sourcesContent":["(ns conduit.db\n  (:require [cljs.reader]\n            [re-frame.core :refer [reg-cofx]]))\n\n;; -- Default app-db Value  ---------------------------------------------------\n;;\n;; When the application first starts, this will be the value put in app-db\n;; Look in:\n;;   1.  `core.cljs` for  \"(dispatch-sync [:initialise-db])\"\n;;   2.  `events.cljs` for the registration of :initialise-db handler\n;;\n(def default-db {:active-page :home})  ;; what gets put into app-db by default.\n\n;; -- Local Storage  ----------------------------------------------------------\n;;\n;; Part of the conduit challenge is to store a user in localStorage, and\n;; on app startup, reload the user from when the program was last run.\n;;\n(def conduit-user-key \"conduit-user\")  ;; localstore key\n\n(defn set-user-ls\n  \"Puts user into localStorage\"\n  [user]\n  (.setItem js/localStorage conduit-user-key (str user)))  ;; sorted-map written as an EDN map\n\n;; Removes user information from localStorge when a user logs out.\n;;\n(defn remove-user-ls\n  \"Removes user from localStorage\"\n  []\n  (.removeItem js/localStorage conduit-user-key))\n\n;; -- cofx Registrations  -----------------------------------------------------\n;;\n;; Use `reg-cofx` to register a \"coeffect handler\" which will inject the user\n;; stored in localStorge.\n;;\n;; To see it used, look in `events.cljs` at the event handler for `:initialise-db`.\n;; That event handler has the interceptor `(inject-cofx :local-store-user)`\n;; The function registered below will be used to fulfill that request.\n;;\n;; We must supply a `sorted-map` but in localStorage it is stored as a `map`.\n;;\n(reg-cofx\n :local-store-user\n (fn [cofx _]\n   (assoc cofx :local-store-user  ;; put the local-store user into the coeffect under :local-store-user\n          (into (sorted-map)      ;; read in user from localstore, and process into a sorted map\n                (some->> (.getItem js/localStorage conduit-user-key)\n                         (cljs.reader/read-string))))))  ;; EDN map -> map\n"]}